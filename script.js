const REG = {length:{m:1,cm:0.01,in:0.0254,ft:0.3048,mi:1609.344},weight:{kg:1,g:0.001,lb:0.45359237,oz:0.028349523125},volume:{L:1,mL:0.001,cup:0.2365882365,tbsp:0.01478676478125,floz:0.0295735295625,gal:3.785411784},speed:{mps:1,kmph:1000/3600,mph:1609.344/3600,knot:1852/3600},data:{B:1,KB:1e3,MB:1e6,GB:1e9,KiB:1024,MiB:1024**2,GiB:1024**3},time:{s:1,min:60,h:3600,d:86400},cooking:{tsp:0.00492892159375,tbsp:0.01478676478125,cup:0.2365882365,mL:0.001,L:1},temp:{C:'C',F:'F',K:'K'}};async function fetchRates(base='USD'){try{const res=await fetch('https://api.exchangerate.host/latest?base='+base);return await res.json()}catch(e){return null}}let FX=null;fetchRates().then(r=>{FX=r});function convertLinear(cat,val,from,to){if(from===to) return val;const reg=REG[cat];const toBase=val*reg[from];return toBase/reg[to]}function convertTemp(val,from,to){if(from===to) return val;let C;if(from==='C')C=val;if(from==='F')C=(val-32)*5/9;if(from==='K')C=val-273.15;if(to==='C')return C;if(to==='F')return C*9/5+32;if(to==='K')return C+273.15}async function convertCurrency(val,from,to){if(!FX) FX=await fetchRates(); if(!FX||!FX.rates) return ''; const base=FX.base||'USD'; let inBase=(from===base)?val:val/(FX.rates[from]||1); return inBase*(FX.rates[to]||1)}window.initConverters=function(){document.querySelectorAll('.converter-form').forEach(form=>{const cat=form.dataset.cat;const from=form.querySelector('.from-unit');const to=form.querySelector('.to-unit');const val=form.querySelector('.value');const out=form.querySelector('.result');let units=[];if(cat==='temp') units=['C','F','K']; else if(cat==='currency') units=['USD','EUR','INR','GBP','JPY','AUD','CAD']; else units=Object.keys(REG[cat]||REG.length); from.innerHTML=units.map(u=>`<option value="${u}">${u}</option>`).join(''); to.innerHTML=from.innerHTML; const update=async ()=>{ if(val.value===''){out.textContent='';return;} const v=Number(val.value.replace(/,/g,'')); if(isNaN(v)){out.textContent='Invalid';return;} if(cat==='temp'){ out.textContent = Math.round((convertTemp(v,from.value,to.value)+Number.EPSILON)*100000)/100000; return;} if(cat==='currency'){ const r = await convertCurrency(v,from.value,to.value); out.textContent = r===''?'':(Math.round((r+Number.EPSILON)*100000)/100000); return;} const r = convertLinear(cat,v,from.value,to.value); out.textContent = Math.round((r+Number.EPSILON)*100000)/100000 }; form.addEventListener('submit',e=>{e.preventDefault();update()}); val.addEventListener('input',update); from.addEventListener('change',update); to.addEventListener('change',update)})};document.addEventListener('DOMContentLoaded',()=>{window.initConverters()});